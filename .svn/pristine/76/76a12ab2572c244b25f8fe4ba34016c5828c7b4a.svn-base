
var nameArr = []
var newArr = []
var id = 1
// 初始化
$(function () {
    function parseUrl() {
        var url = location.href;
        var i = url.indexOf('?');
        if (i == -1) return 0;
        var querystr = url.substr(i + 1);
        var arr1 = querystr.split('&');
        var arr2 = new Object();
        for (i in arr1) {
            var ta = arr1[i].split('=');
            arr2[ta[0]] = ta[1];
        }
        return arr2;
    }

    var v = parseUrl()
    var dataOrder={
        id:1
    }
    // // 详情接口
    // _duty .order(dataOrder,orderResolve,orderReject)
    // // 请求成功后的函数
    // function orderResolve(res) {
    //     console.log(res)
    // }
    // // 请求失败的函数
    // function orderReject(err) {
    //     console.log('woshi',err)
    // }
    // 获取所有的订单信息class
    $('.orderlist')
    //获取用户地址class
    $('.D_name')
    // 渠道信息class
    $('.D_qudao')
    // 商家人员class
    $('.D_People')
    // 服务信息遍历新增
    var arr=[1,2,3,4,5]
    for(var i=0;i<arr.length;i++){
        var html=' <tr>\n' +
            '                    <td>服务名称服务名称1</td>\n' +
            '                    <td>空调--维修2</td>\n' +
            '                    <td>定金3</td>\n' +
            '                    <td>￥130.00</td>\n' +
            '                    <td>22</td>\n' +
            '                </tr>'
        $('#D_addChild').append(html)
    }
    //财务信息class
    $('.D_caiwu')
    // 订单备注class
    $('#D_bzContent')
    // 遍历操作数据i
    var caozouarr=[1,2,3,4,5]
    for(var i=0;i<caozouarr.length;i++){
        var html=' <tr>\n' +
            '                    <td>确认订单</td>\n' +
            '                    <td>人生就像是一场修行'+i+'</td>\n' +
            '                    <td>2016-11-29 15:30</td>\n' +
            '                </tr>'
        $('#D_caozuo').append(html)
    }
    // 遍历操作数据i
    var addChildCao=[1,2,3,4,5]
    for(var i=0;i<addChildCao.length;i++){
        var html='  <tr>\n' +
            '                    <td>服务名称服务名称'+i+'</td>\n' +
            '                    <td>空调--维修</td>\n' +
            '                    <td>定金</td>\n' +
            '                    <td>￥130.00</td>\n' +
            '                    <td>2</td>\n' +
            '                    <td class="D_CBtn">手动选择'+i+'</td>\n' +
            '                </tr>'
        $('#D_addChildCao').append(html)
    }
    switch (Number(v.id)) {
        case 2:
            //待商家指派
            $('#suerBtn').html('分配工程师')
            id = v.id
            break;
        case 3:
            // 待商家发出
            $('#suerBtn').html('确认出发')

            id = v.id
            $("#newEngineer").removeClass("D_none");
            break;
        case 4:
            // 带到达
            $('#suerBtn').html('确认到达')
            id = v.id
            $("#newEngineer").addClass("D_none");
            break;
        case 5:
            // 带服务
            $('#suerBtn').html('开始服务')
            id = v.id
            break;
        case 6:
            // 待确认
            $('#suerBtn').html('确认完成服务')
            $('#D_Bcj').removeClass('D_none')
            id = v.id
            //是否显示取消订单按钮
            $('#cancelBtn').addClass('D_none')
            break;
        case 7:
            // 待补差价
            $('#suerBtn').html('确认支付')
            $('#D_Bcj').removeClass('D_none')
            id = v.id
            //是否显示取消订单按钮
            $('#cancelBtn').addClass('D_none')
            break;
        case 8:
            // 待回访
            $('#suerBtn').html('确认回访')
            $('#D_Bcj').removeClass('D_none')
            id = v.id
            //是否显示取消订单按钮
            $('#cancelBtn').addClass('D_none')
            break;
        case 9:
            // 已完成
            $('#suerBtn').addClass('D_none')
            id = v.id
            //是否显示取消订单按钮
            $('#cancelBtn').addClass('D_none')
            $('#D_Bcj').removeClass('D_none')
            break;
        case 10:
            // 已取消订单
            $('#suerBtn').addClass('D_none')
            id = v.id
            //是否显示取消订单按钮
            $('#cancelBtn').addClass('D_none')
            $('#D_Bcj').removeClass('D_none')
            break;
        case 11:
            // 异常订单
            $('#suerBtn').html('手动重选服务')
            $('#D_Qd').addClass('D_none')
            id = v.id
            break;
        default:
            //待商家接单
            $('#D_Qd').addClass('D_none')
            $('#oneBtn').removeClass('D_none')
            $('#twoBtn').removeClass('D_none')
            $('#D_FwOne').addClass('D_none')
            $('#D_FwTwo').removeClass('D_none')
            break
    }
});
layui.use('laydate', function () {
    var laydate = layui.laydate;
    // laydate.skin(lib)

    var start = {
        format: 'YYYY-MM-DD hh:mm:ss',
        istime: true,
        issure: false,
        isclear: false,
        fixed: true
    };
    document.querySelector('#test5').onclick = function () {
        start.elem = this;
        laydate(start);
    }

})
// 打开弹框
$('#oneBtn').bind('click', function () {
    $("#D_none").removeClass("D_none");
    $('.D_name').each(function () {
        $(this).text()
        nameArr.push($(this).text())
    });
    $('.nameInput').eq(0).val(nameArr[0])
    $('.nameInput').eq(1).val(nameArr[4])
    $('.nameInput').eq(2).val(nameArr[1])
    $('.nameInput').eq(3).val(nameArr[2])
    $('.nameInput').eq(4).val(nameArr[3])
    nameArr = []
})
$('#D_tjbtn').bind('click', function (event) {
    event.preventDefault();
    $('.nameInput').each(function () {
        newArr.push($(this).val())
    })
    $('.D_name').eq(0).text(newArr[0])
    $('.D_name').eq(1).text(newArr[2])
    $('.D_name').eq(2).text(newArr[3])
    $('.D_name').eq(3).text(newArr[4])
    $('.D_name').eq(4).text(newArr[1])
    $("#D_none").addClass("D_none");
    newArr = []
})
$('#twoBtn').bind('click', function () {
    $("#D_none1").removeClass("D_none");
    $('.bjInput').val($('#D_bzContent').html())
})
$('#D_tjbtn1').bind('click', function (event) {
    event.preventDefault();
    $('#D_bzContent').html($('.bjInput').val())
    $("#D_none1").addClass("D_none");

})
// 关闭弹框
$('#I_con').bind('click', function () {
    $("#D_none").addClass("D_none");
})
$('#I_con1').bind('click', function () {
    $("#D_none1").addClass("D_none");
})
// 选择工程师时复选变单选
$("input[name='SingleElection']").on('click', function () {
    // 取消全部checkbox的选中
    $("input[name='SingleElection']").prop("checked", false);
    // 设置选中当前
    $(this).prop("checked", true);
});
// 选择服务时复选变单选
$("input[name='SingleCz']").on('click', function () {
    // 取消全部checkbox的选中
    $("input[name='SingleCz']").prop("checked", false);
    // 设置选中当前
    $(this).prop("checked", true);
});
// 手动选择服务打开弹窗
var that
$('#D_addChildCao').on('click','.D_CBtn',function () {
   $('#D_Cz').removeClass('D_none')
    that=this
})
// 获取被选中的的服务的值
$('#CzBtn').bind('click',function () {

})
// 关闭服务弹框
$('#D_EngineerCz').bind('click',function () {
    $('#D_Cz').addClass('D_none')
})
var myarr=[1,2,4,5,6]
$('#CzBtn').bind('click',function () {
    console.log(that)
        $(that).siblings().each(function (index) {
                $(this).text(myarr[index])
})

})
//重选服务
$("input[name='D_Choose']").on('click', function () {
    // 取消全部checkbox的选中
    $("input[name='D_Choose']").prop("checked", false);
    // 设置选中当前
    $(this).prop("checked", true);
});
$('#I_Engineer').bind('click', function () {
    $('#Engineer').addClass('D_none')

})
// 确认订单与 分配工程师、
$('#suerBtn').bind('click', function () {

    switch (Number(id)) {
        case 1:
            window.location.href = "./OrderDetails.html?id=2";
            break;
        case 2:
            $('#Engineer').removeClass('D_none')

            break;
        case 3:
            window.location.href = "./OrderDetails.html?id=4";
            break;
        case 4:
            window.location.href = "./OrderDetails.html?id=5";
            break;
        case 5:
            window.location.href = "./OrderDetails.html?id=6";
            break;
        case 6:
            $('#over').removeClass('D_none')
            break;
        case 7:
            // $('#over').removeClass('D_none')
            window.location.href = "./OrderDetails.html?id=8"
            break;
        case 8:
            $('#D_Win').removeClass('D_none')
            break;
        case 11:
            $('#D_Ycover').removeClass('D_none')
            break;
    }

})
// 从新分配工程师
$('#newEngineer').bind('click', function () {
    $('#Engineer').removeClass('D_none')
})
//跳转带出发
$('#EngineerBtn').bind('click', function () {
    switch (Number(id)) {
        case 2:
            window.location.href = "./OrderDetails.html?id=3";
            break;
        case 3:
            $('#Engineer').addClass('D_none')
    }

})
// 新增
$('#D_FwBtn').bind('click', function () {
    var html = ' <tr>\n' +
        '                            <td>\n' +
        '                                <input class="D_FwCheck" type="checkbox" value="配件" title="配件"/>\n' +
        '                                <span>配件</span>\n' +
        '                            </td>\n' +
        '                            <td><input class="D_Ipt" type="text"></td>\n' +
        '                            <td><input class="D_Ipt" type="text"></td>\n' +
        '                            <td><i class="D_IconFw layui-icon ">&#x1006;</i></td>\n' +
        '                        </tr>'
    $('#D_addTable').append(html)
})
// 删除j节点
$('#D_addTable').on('click', 'i', function () {
    $(this).parent().parent().remove()
})
// 关闭服务弹框
$('#O_Engineer').bind('click', function () {
    $('#over').addClass('D_none')
})
//确认完成弹框按钮
$('#D_child').bind('click', function () {
    window.location.href = "./OrderDetails.html?id=7";
})
//评星
// var inputBox = $('.comments-list').find('input');
$('.eval-star span').raty({
    click: function (score) {
        console.log(score)
        $('.eval-star input[name="star"]').val(score);
    },
    starOff: '../image/star_b_grray.jpg',
    starOn: '../image/star_b_red.jpg',
    starHalf: '../image/star_b_helf.jpg',
    half: true
});

//设置input,textarea默认值
if (!('placeholder' in document.createElement('input'))) {
    $('input[placeholder],textarea[placeholder]').each(function () {
        var that = $(this),
            text = that.attr('placeholder');
        // console.log(text);
        if (that.val() === "") {
            that.val(text).addClass('placeholder');
        }
        that.focus(function () {
            if (that.val() === text) {
                that.val("").removeClass('placeholder');
            }
        }).blur(function () {
            if (that.val() === "") {
                that.val(text).addClass('placeholder');
            }
        }).closest('form').submit(function () {
            if (that.val() === text) {
                that.val('');
            }
        });
    });
}
$('#cancelBtn').bind('click', function () {
    window.location.href = "./OrderDetails.html?id=9";
})
//确认完成
$('.sbmit').bind('click', function () {
    window.location.href = "./OrderDetails.html?id=10";
})
// 暂时跳转异常页面
$('#close').bind('click', function () {
    window.location.href = "./OrderDetails.html?id=11";
})